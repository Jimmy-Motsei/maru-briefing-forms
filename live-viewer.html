<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Maru Forms Live Viewer</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .viewer-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      .form-panel {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
        background: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .form-header {
        background: #f9fafb;
        padding: 16px;
        border-bottom: 1px solid #e5e7eb;
        font-weight: 600;
        color: #374151;
      }
      .form-iframe {
        width: 100%;
        height: 800px;
        border: none;
        display: block;
      }
      .viewer-controls {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      .control-button {
        display: block;
        width: 100%;
        margin-bottom: 8px;
        padding: 8px 16px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .control-button:hover {
        background: #2563eb;
      }
      .control-button.secondary {
        background: #6b7280;
      }
      .control-button.secondary:hover {
        background: #4b5563;
      }
      .status-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-live {
        background: #10b981;
      }
      .status-paused {
        background: #f59e0b;
      }
      .status-stopped {
        background: #ef4444;
      }
      @media (max-width: 768px) {
        .viewer-container {
          grid-template-columns: 1fr;
        }
        .form-iframe {
          height: 600px;
        }
        .viewer-controls {
          position: relative;
          top: auto;
          right: auto;
          margin-bottom: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="viewer-controls">
      <h3 style="margin: 0 0 12px 0; font-size: 16px">Live Viewer Controls</h3>
      <button class="control-button" onclick="toggleAutoRefresh()">
        <span id="refresh-status" class="status-indicator status-live"></span>
        <span id="refresh-text">Auto Refresh: ON</span>
      </button>
      <button class="control-button secondary" onclick="refreshForms()">
        Manual Refresh
      </button>
      <button class="control-button secondary" onclick="openForm('web-dev')">
        Open Web Dev Form
      </button>
      <button class="control-button secondary" onclick="openForm('support')">
        Open Support Form
      </button>
      <button
        class="control-button secondary"
        onclick="openForm('ai-solution')"
      >
        Open AI Solution Form
      </button>
    </div>

    <div class="viewer-container">
      <div class="form-panel">
        <div class="form-header">ðŸ“‹ Maru Online Web Dev Briefing Form (v2)</div>
        <iframe
          id="web-dev-iframe"
          class="form-iframe"
          src="maru-web-dev-briefing-v2.html"
          title="Web Dev Briefing Form"
        ></iframe>
      </div>

      <div class="form-panel">
        <div class="form-header">ðŸŽ« Support Ticket Form</div>
        <iframe
          id="support-iframe"
          class="form-iframe"
          src="support.html"
          title="Support Ticket Form"
        ></iframe>
      </div>
    </div>

    <div class="viewer-container" style="margin-top: 20px">
      <div class="form-panel">
        <div class="form-header">ðŸ¤– AI Solution Briefing Form (v2)</div>
        <iframe
          id="ai-solution-iframe"
          class="form-iframe"
          src="ai-solution-briefing-v2.html"
          title="AI Solution Briefing Form"
        ></iframe>
      </div>

      <div class="form-panel">
        <div class="form-header">ðŸ“Š Form Analytics & Status</div>
        <div style="padding: 20px">
          <h3>Form Status</h3>
          <div id="form-status">
            <p>âœ… Web Dev Form: Ready</p>
            <p>âœ… Support Form: Ready with Payment Integration</p>
            <p>âœ… AI Solution Form: Ready</p>
          </div>

          <h3 style="margin-top: 24px">Recent Updates</h3>
          <div id="recent-updates" style="font-size: 14px; color: #6b7280">
            <p>â€¢ Added R12.5k-R25k budget range to Web Dev form</p>
            <p>
              â€¢ Implemented auto-estimate + FNB payment flow for Support form
            </p>
            <p>â€¢ Added QuickBooks integration for estimate creation</p>
            <p>â€¢ Created payment confirmation flow with localStorage</p>
          </div>

          <h3 style="margin-top: 24px">Payment Flow Features</h3>
          <div style="font-size: 14px; color: #6b7280">
            <p>â€¢ Auto-calculates hours based on priority + asset type</p>
            <p>â€¢ Business hours detection (R275/hr vs R350/hr)</p>
            <p>â€¢ SLA-based gating (R375 deposit for non-SLA)</p>
            <p>â€¢ QuickBooks estimate creation</p>
            <p>â€¢ FNB payment integration (placeholder)</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let autoRefresh = true;
      let refreshInterval;

      function toggleAutoRefresh() {
        autoRefresh = !autoRefresh;
        const statusEl = document.getElementById("refresh-status");
        const textEl = document.getElementById("refresh-text");

        if (autoRefresh) {
          statusEl.className = "status-indicator status-live";
          textEl.textContent = "Auto Refresh: ON";
          startAutoRefresh();
        } else {
          statusEl.className = "status-indicator status-paused";
          textEl.textContent = "Auto Refresh: OFF";
          stopAutoRefresh();
        }
      }

      function startAutoRefresh() {
        if (refreshInterval) clearInterval(refreshInterval);
        refreshInterval = setInterval(refreshForms, 5000); // Refresh every 5 seconds
      }

      function stopAutoRefresh() {
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
      }

      function refreshForms() {
        const iframes = document.querySelectorAll(".form-iframe");
        iframes.forEach((iframe) => {
          const currentSrc = iframe.src;
          iframe.src = "";
          setTimeout(() => {
            iframe.src = currentSrc;
          }, 100);
        });
      }

      function openForm(formType) {
        const urls = {
          "web-dev": "maru-web-dev-briefing-v2.html",
          support: "support.html",
          "ai-solution": "ai-solution-briefing-v2.html",
        };

        if (urls[formType]) {
          window.open(urls[formType], "_blank");
        }
      }

      // Initialize auto-refresh
      if (autoRefresh) {
        startAutoRefresh();
      }

      // Add keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case "r":
              e.preventDefault();
              refreshForms();
              break;
            case "t":
              e.preventDefault();
              toggleAutoRefresh();
              break;
          }
        }
      });

      // Add form interaction tracking
      function trackFormInteraction(formName, action) {
        console.log(`Form Interaction: ${formName} - ${action}`);
        // You could send this to analytics here
      }

      // Listen for messages from iframes (if they send any)
      window.addEventListener("message", function (event) {
        if (event.data && event.data.type) {
          console.log("Message from iframe:", event.data);
        }
      });
    </script>
  </body>
</html>
